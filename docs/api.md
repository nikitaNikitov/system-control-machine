# Документация по работе с API

## Использование

В данный момент не требуется использовать какой-то ключ для взаимодействия с API, но он всегда может появиться, либо появиться стороние условия, поэтому следует чаще проверять данную документацию

Все методы выполняются по адресу `serverip:port/api/` и ниак иначе, оффициально брать информацию о пользователях и работать через сторонние автоматизированные программы можно только оттуда

Для всех методов, которые не помечены как @csrf_exempt, необходимо иметь как мининум csrf токен, а как максимум авторизацию на сайте (готовые cookies["csrftoken", "sessionid"])

## Методы

- [getUser](#--getuser)
- [qr](#--qr)

---------------

@csrf_exempt
### - `getUser`

  Позволяет получить информацию о пользователе с помощью кода, который можно получить через QR код пользователя

#### Запрос

 В заголовке необходимо указать токен авторизации станка: "Authorization: Bearer 'token'"

- `GET` -> getUser?code=code
- `POST` -> getUser

```json
  {
    "code": "code"
  }
  ```

#### Параметры

- `code` - Код пользователя
  
#### Ответ
  
  ```json
  {
    "username": "Username", 
    "fullname": "Full name", 
    "group": "ИУ0-01",
    "access": true
  }
  ```

| Название      | Описание                                     |
| ------------- | -------------------------------------------- |
| `username`    | Никнейм пользователя                         |
| `fullname`    | ФИО пользователя                             |
| `group`       | Группа пользователя                          |
| `access`      | Есть ли доступ у пользователя к этому станку |

---------------

### - `qr`

  Позволяет получить QR код пользователя в текстовом виде

#### Запрос

- `GET` -> qr

#### Параметры

#### Ответ
  
  ```json
  {
    "code": "code", 
    "time_start": 1676756720, 
    "time_expire": 1676757020
  }
  ```

| Название      | Описание              |
| ------------- | --------------------- |
| `code`        | Код QR кода           |
| `time_start`  | Время начала действия |
| `time_expire` | Время конца действия  |

## Ошибки при работе с API

При возникновения ошибки, которая обрабатывается кодом, будет отображаться в формате

```json
{
  "error": 1,
  "error_msg": "Описание ошибки"
}
```

| Номер ошибки | Описание ошибки                                          |
| ------------ | -------------------------------------------------------- |
| 1            | Неизвестная ошибка                                       |
| 10           | Пользователь не найден                                   |
| 11           | Пользователь не является преподавателем                  |
| 12           | Пользователь не является студентом                       |
| 13           | Станок не найден                                         |
| 14           | Пользователи из аргументов не найдены                    |
| 20           | Токен не отправлен                                       |
| 21           | Токен не действителен                                    |
| 101          | Код не был отправлен с клиента                           |
| 102          | Код отсутствует в базе данных                            |
| 103          | Код пока не действителен, будет действителен через время |
| 104          | Код просрочен                                            |
| 110          | Отсутствует аргумент                                     |
| 111          | Параметр не является числом                              |
| 112          | Число параметра меньше единицы                           |
| 113          | Такой индентификатор уже существует                      |
